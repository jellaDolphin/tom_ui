cmake_minimum_required(VERSION 3.1.0)

set(CMAKE_MODULE_PATH cmake)

# Include Qt basic functions
include(cmake/QtCommon.cmake)

# Basic information about project
project(tom-ui
        VERSION 1.0.0
        DESCRIPTION "Tom Time Tracker"
        HOMEPAGE_URL "https://github.com/jansorg/tom-ui"
        )

# Set PROJECT_VERSION_PATCH and PROJECT_VERSION_TWEAK to 0 if not present, needed by add_project_meta
fix_project_version()

# Set additional project information
set(COMPANY "Joachim Ansorg")
set(COPYRIGHT "Copyright (c) 2019 Joachim Ansorg. All rights reserved.")
set(IDENTIFIER "eu.ja-dev.tomui")

set(MACOSX_BUNDLE_BUNDLE_NAME ${PROJECT_DESCRIPTION})

add_project_meta(META_FILES_TO_INCLUDE)

set(RESOURCE_FILES resources/resources.qrc)

configure_file (
        "source/version.h.in"
        "${PROJECT_BINARY_DIR}/version.h"
)

file(GLOB_RECURSE UI_FILES source/*.ui)
file(GLOB_RECURSE CODE_FILES source/*.cpp)

add_compile_options(-std=c++11 -Wall -Wextra)
if(CMAKE_BUILD_TYPE EQUAL "release")
    add_compile_options(-O2)
endif()

add_executable(${PROJECT_NAME} ${OS_BUNDLE} # Expands to WIN32 or MACOS_BUNDLE depending on OS
    ${CODE_FILES} ${META_FILES_TO_INCLUDE} ${RESOURCE_FILES}
)

if(APPLE)
    set_target_properties(${PROJECT_NAME} PROPERTIES OUTPUT_NAME "tom")
endif()

target_include_directories(${PROJECT_NAME} PRIVATE source)
target_include_directories(${PROJECT_NAME} PRIVATE ${PROJECT_BINARY_DIR})

# setup libraries
find_package(Qt5 COMPONENTS Core Widgets Svg REQUIRED)

target_link_libraries(${PROJECT_NAME} Qt5::Widgets Qt5::Svg)

if (UNIX)
    install(TARGETS ${PROJECT_NAME} DESTINATION bin)
elseif(APPLE)
    install(TARGETS ${PROJECT_NAME} DESTINATION .)
    set(CMAKE_INSTALL_PREFIX ${CMAKE_BINARY_DIR})
    install(CODE "
        include(BundleUtilities)
        fixup_bundle(${CMAKE_INSTALL_PREFIX}/tom-ui.app \"\" \"\")
    " COMPONENT Runtime)
elseif(WIN32)
    install(TARGETS ${PROJECT_NAME} DESTINATION bin)
endif()


INCLUDE(CPack)
